<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Financeiro</title>

    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/financeiro.css">
</head>

<body>

    <!-- MENU SUPERIOR -->
    <div class="top-menu">
        <span class="menu-button" id="toggleMenu">‚ò∞ Menu</span>

        <div class="dropdown-menu" id="dropdown-menu">
            <a href="listagem-reservas.html">Reservas</a>
            <a href="calendario.html">Calendario</a>
            <a href="limpeza.html">Limpeza</a>
            <a href="precos.html">Pre√ßos</a>
            <a href="resultados.html">Resultados</a>
            <a id="btnSyncFirebase" class="btn-sync-global">üîÑ Sincronizar</a>
            <a href="login.html" class="sair">Sair</a>
        </div>
    </div>

    <div class="content">

        <h1>Financeiro</h1>

        <!-- ABAS -->
        <div class="tabs">
            <button class="tab active" data-tab="limpeza">Limpeza</button>
            <button class="tab" data-tab="custos-iva">Custos & IVA (QR Code)</button>
            <button class="tab" data-tab="condominio">Condom√≠nio</button>
            <button class="tab" data-tab="agua">√Ågua</button>
            <button class="tab" data-tab="luz">Luz</button>
            <button class="tab" data-tab="impostos">Impostos</button>
            <button class="tab" data-tab="equipamentos">Equipamentos</button>
            <button class="tab" data-tab="outros">Outros</button>
        </div>

        <!-- CONTE√öDOS DAS ABAS -->
        <div class="tab-content active" id="tab-limpeza">

            <h2>Custos de Limpeza</h2>

            <!-- Sele√ß√£o de m√™s -->
            <div class="filtros-custos">
                <label>M√™s:</label>
                <select id="selectMes">
                    <option value="1">Janeiro</option>
                    <option value="2">Fevereiro</option>
                    <option value="3">Mar√ßo</option>
                    <option value="4">Abril</option>
                    <option value="5">Maio</option>
                    <option value="6">Junho</option>
                    <option value="7">Julho</option>
                    <option value="8">Agosto</option>
                    <option value="9">Setembro</option>
                    <option value="10">Outubro</option>
                    <option value="11">Novembro</option>
                    <option value="12">Dezembro</option>
                </select>

                <label>Ano:</label>
                <select id="selectAno">
                    <option value="2020">2020</option>
                    <option value="2021">2021</option>
                    <option value="2022">2022</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                    <option value="2027">2027</option>
                    <option value="2028">2028</option>
                    <option value="2029">2029</option>
                    <option value="2030">2030</option>
                    <option value="2031">2031</option>
                    <option value="2032">2032</option>
                    <option value="2033">2033</option>
                    <option value="2034">2034</option>
                    <option value="2035">2035</option>
                    <option value="2036">2036</option>
                    <option value="2037">2037</option>
                    <option value="2038">2038</option>
                    <option value="2039">2039</option>
                    <option value="2040">2040</option>
                    <option value="2041">2041</option>
                    <option value="2042">2042</option>
                    <option value="2043">2043</option>
                    <option value="2044">2044</option>
                    <option value="2045">2045</option>
                    <option value="2046">2046</option>
                    <option value="2047">2047</option>
                    <option value="2048">2048</option>
                    <option value="2049">2049</option>
                    <option value="2050">2050</option>
                </select>
            </div>

            <!-- Previs√£o -->
            <div class="card">
                <h3>Previs√£o de Custos</h3>
                <p id="previsaoValor">0 ‚Ç¨</p>
            </div>

            <!-- Custo Real -->
            <div class="card">
                <h3>Custo Real</h3>
                <p id="custoRealValor">0 ‚Ç¨</p>
            </div>

            <div class="card">
                <h3>Detalhe do M√™s</h3>

                <div class="acoes-financeiro">
                    <button id="btnExportExcel">Exportar Excel</button>
                    <button id="btnExportPDF">Exportar PDF</button>
                </div>

                <table id="tabelaDetalheMes">
                    <thead>
                        <tr>
                            <th>Apartamento</th>
                            <th>Cliente</th>
                            <th>Check‚Äëin</th>
                            <th>Check‚Äëout</th>
                            <th>Valor (‚Ç¨)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Extras -->
            <div class="card">
                <h3>Custos Extra</h3>

                <div class="extra-form">
                    <input type="date" id="extraData">
                    <input type="number" id="extraValor" placeholder="Valor (‚Ç¨)">
                    <input type="text" id="extraDescricao" placeholder="Descri√ß√£o">
                    <button id="btnAdicionarExtra">Adicionar</button>
                </div>

                <table id="tabelaExtras">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Descri√ß√£o</th>
                            <th>Valor (‚Ç¨)</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="card">
                <h3>Totais Anuais</h3>

                <table id="tabelaTotaisAno">
                    <thead>
                        <tr>
                            <th>Ano</th>
                            <th>Limpezas (‚Ç¨)</th>
                            <th>Extras (‚Ç¨)</th>
                            <th>Total (‚Ç¨)</th>
                            <th>Acumulado</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

</div> <!-- fecha tab-limpeza -->

<!-- ABA CUSTOS & IVA -->
<div class="tab-content" id="tab-custos-iva">

    <h2>Custos & IVA (QR Code)</h2>

    <div class="acoes-financeiro">
        <button class="btn-add" onclick="irParaEntidades()">Gerir Entidades</button>
        <button class="btn-add" onclick="irParaCategorias()">Gerir Categorias</button>
    </div>

    <div class="card">
        <h3>Importar Fatura via QR Code</h3>

        <div class="acoes-financeiro">
            <button id="btnScanQR">üì∑ Ler QR da Fatura</button>
            <button id="btnStopQR" style="background:#c62828; color:white;">‚õî Parar C√¢mara</button>
        </div>

        <div id="qr-reader" style="width:300px; margin-top:15px;"></div>
    </div>

    <div class="card">
    <h3>Faturas Importadas</h3>

    <!-- A√ß√µes principais -->
    <div class="acoes-financeiro">
        <button id="btnApagarSelecionados" class="btn btn-red">Apagar Selecionados</button>
        <button id="btnNovaFatura" class="btn btn-blue">Adicionar Fatura Manual</button>
        <button id="btnExportExcelFaturas" class="btn btn-blue">Exportar Excel</button>
        <button id="btnExportPDFFaturas" class="btn btn-blue">Exportar PDF</button>
    </div>

    <!-- Filtros -->
    <div class="filtros-custos-iva">

        <div class="campo">
            <label>NIF</label>
            <input type="text" id="filtroNIF" placeholder="Filtrar por NIF">
        </div>

        <div class="campo">
            <label>Entidade</label>
            <input type="text" id="filtroEntidade" placeholder="Filtrar por Entidade">
        </div>

        <div class="campo">
            <label>Categoria</label>
            <select id="filtroCategoria">
                <option value="">Todas</option>
                <!-- depois vamos ligar isto a categorias do Firebase, por agora pode ficar assim -->
                <option value="√Ågua">√Ågua</option>
                <option value="Energia">Energia</option>
                <option value="Telecomunica√ß√µes">Telecomunica√ß√µes</option>
                <option value="Combust√≠vel">Combust√≠vel</option>
                <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                <option value="Bricolage">Bricolage</option>
                <option value="Constru√ß√£o">Constru√ß√£o</option>
                <option value="Decora√ß√£o">Decora√ß√£o</option>
                <option value="Equipamentos">Equipamentos</option>
                <option value="Servi√ßos">Servi√ßos</option>
                <option value="Outros">Outros</option>
            </select>
        </div>

        <div class="campo">
            <label>In√≠cio</label>
            <input type="date" id="filtroDataInicio">
        </div>

        <div class="campo">
            <label>Fim</label>
            <input type="date" id="filtroDataFim">
        </div>

        <div class="campo botao-gerar">
            <button onclick="renderizarTabelaFaturas()">Filtrar</button>
        </div>
    </div>

    <!-- Tabela com suporte a CRUD -->
    <table id="tabelaCustosIVA">
        <thead>
            <tr>
                <th><input type="checkbox" id="checkAll"></th>
                <th>Data</th>
                <th>Fornecedor</th>
                <th>NIF</th>
                <th>Categoria</th>
                <th>Valor (‚Ç¨)</th>
                <th>IVA (‚Ç¨)</th>
                <th>IVA gas√≥leo (‚Ç¨)</th>
                <th>L√≠quido (‚Ç¨)</th>
                <th>N¬∫ Fatura</th>
                <th>ATCUD</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>


</div>


        <div class="tab-content" id="tab-condominio"></div>
        <div class="tab-content" id="tab-agua"></div>
        <div class="tab-content" id="tab-luz"></div>
        <div class="tab-content" id="tab-impostos"></div>
        <div class="tab-content" id="tab-equipamentos"></div>
        <div class="tab-content" id="tab-outros"></div>

    </div> <!-- fecha .content -->

    <script src="https://unpkg.com/html5-qrcode"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

        <script src="js/firebase-config.js"></script>
    <script src="js/menu.js"></script>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const tabs = document.querySelectorAll(".tab");
        const contents = document.querySelectorAll(".tab-content");

        if (!tabs.length || !contents.length) return;

        tabs.forEach(tab => {
            tab.addEventListener("click", () => {
                const target = tab.getAttribute("data-tab");
                const content = document.getElementById("tab-" + target);
                if (!content) return;

                tabs.forEach(t => t.classList.remove("active"));
                contents.forEach(c => c.classList.remove("active"));

                tab.classList.add("active");
                content.classList.add("active");
            });
        });
    });
    </script>

    <script>
        firebase.auth().onAuthStateChanged(user => {
            if (!user) {
                window.location.href = "login.html";
                return;
            }
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <script src="js/financeiro.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            initFinanceiro();
        });
    </script>
</body>
</html>
