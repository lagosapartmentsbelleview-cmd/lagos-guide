<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Gestão de Reservas</title>

    <!-- CSS GLOBAL -->
    <link rel="stylesheet" href="css/base.css">

    <!-- CSS ESPECÍFICO DA PÁGINA DE RESERVAS -->
    <link rel="stylesheet" href="css/reservas.css">
</head>

<body>

    <h1>Gestão de Reservas</h1>

    <!-- AÇÕES -->
    <div id="acoes">
        <button id="btnNovaReserva">Nova Reserva</button>
        <button id="btnImportarExcel">Importar Booking</button>
        <button id="btnApagarSelecionadas">Apagar Selecionadas</button>
        <button id="btnSincronizarCalendario">Enviar Calendário</button>
        <button id="btnIrCalendario">Calendário</button>
        <button id="btnLimparFantasmas">Limpar Calendário</button>
        <button id="btnMarcarPagas">Marcar Pagas</button>
        <button id="btnLogout">Sair</button>
    </div>

    <!-- INPUT PARA IMPORTAÇÃO BOOKING -->
    <input type="file" id="inputExcelBooking" accept=".xlsx" style="display:none">

    <!-- FILTROS -->
    <div id="filtros">
        <select id="filtroAnoInicio" onchange="aplicarFiltroIntervalo()">
            <option value="">Ano início</option>
            <option value="2023">2023</option>
            <option value="2024">2024</option>
            <option value="2025">2025</option>
            <option value="2026">2026</option>
        </select>

        <select id="filtroMesInicio" onchange="aplicarFiltroIntervalo()">
            <option value="">Mês início</option>
            <option value="1">Janeiro</option>
            <option value="2">Fevereiro</option>
            <option value="3">Março</option>
            <option value="4">Abril</option>
            <option value="5">Maio</option>
            <option value="6">Junho</option>
            <option value="7">Julho</option>
            <option value="8">Agosto</option>
            <option value="9">Setembro</option>
            <option value="10">Outubro</option>
            <option value="11">Novembro</option>
            <option value="12">Dezembro</option>
        </select>

        <select id="filtroAnoFim" onchange="aplicarFiltroIntervalo()">
            <option value="">Ano fim</option>
            <option value="2023">2023</option>
            <option value="2024">2024</option>
            <option value="2025">2025</option>
            <option value="2026">2026</option>
        </select>

        <select id="filtroMesFim" onchange="aplicarFiltroIntervalo()">
            <option value="">Mês fim</option>
            <option value="1">Janeiro</option>
            <option value="2">Fevereiro</option>
            <option value="3">Março</option>
            <option value="4">Abril</option>
            <option value="5">Maio</option>
            <option value="6">Junho</option>
            <option value="7">Julho</option>
            <option value="8">Agosto</option>
            <option value="9">Setembro</option>
            <option value="10">Outubro</option>
            <option value="11">Novembro</option>
            <option value="12">Dezembro</option>
        </select>
    </div>

    <!-- TABELA -->
    <div class="tabela-wrapper">
        <table id="tabelaReservas">
            <thead>
                <tr>
                    <th class="no-sort"><input type="checkbox" id="selectAll"></th>

                    <th data-col="origem">Origem</th>
                    <th data-col="bookingId">Nº Reserva</th>
                    <th data-col="cliente">Hóspede</th>
                    <th data-col="quartos">Quartos</th>
                    <th data-col="apartamentos">Apartamentos</th>
                    <th data-col="pessoas">Pessoas</th>

                    <th data-col="checkin">Check-in</th>
                    <th data-col="checkout">Check-out</th>
                    <th data-col="noites">Noites</th>

                    <th data-col="totalBruto">Total Bruto (€)</th>
                    <th data-col="comissaoServico">Comissão Serviço (€)</th>
                    <th data-col="comissaoPagamento">Comissão Pagamento (€)</th>
                    <th data-col="comissaoTotal">Comissão Total (€)</th>
                    <th data-col="precoNoite">Valor/Noite (€)</th>
                    <th data-col="berco">Berço</th>
                    <th data-col="limpeza">Limpeza (€)</th>
                    <th data-col="liquido">Líquido (€)</th>

                    <th class="no-sort">Ações</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- MODAL DE RESERVA -->
    <div id="modalReserva" class="modal">
        <div class="modal-content">

            <div class="modal-header">
                <h2 id="modalReservaTitulo">Reserva</h2>
                <button class="modal-close" onclick="fecharModal()">✖</button>
            </div>

            <div class="modal-body">

                <!-- ORIGEM -->
                <div class="modal-section-title">Origem</div>
                <select id="origem">
                    <option value="Booking">Booking</option>
                    <option value="Airbnb">Airbnb</option>
                    <option value="VRBO">VRBO</option>
                    <option value="Expedia">Expedia</option>
                    <option value="Agoda">Agoda</option>
                    <option value="Hotels">Hotels.com</option>
                    <option value="Trip">Trip.com</option>
                    <option value="Particular">Particular</option>
                </select>

                <label>Número da Reserva (Booking)</label>
                <input type="text" id="bookingId">

                <!-- HÓSPEDE -->
                <div class="modal-section-title">Hóspede</div>

                <label>Cliente</label>
                <input type="text" id="cliente">

                <label>País</label>
                <select id="paisCliente">
                    <option value="pt" selected>Portugal</option>
                    <option value="es">Espanha</option>
                    <option value="fr">França</option>
                    <option value="gb">Reino Unido</option>
                    <option value="de">Alemanha</option>
                    <option value="br">Brasil</option>
                    <!-- (restantes países se quiseres) -->
                </select>

                <label>Telefone</label>
                <input type="text" id="telefone">

                <label>Morada</label>
                <input type="text" id="morada">

                <label>Adultos</label>
                <input type="number" id="adultos">

                <label>Crianças</label>
                <input type="number" id="criancas">

                <label>Idades das Crianças</label>
                <input type="text" id="idadesCriancas">

                <!-- ALOJAMENTO -->
                <div class="modal-section-title">Alojamento</div>

                <label>Quartos</label>
                <select id="quartos">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                </select>

                <label>Apartamentos</label>
                <input type="text" id="apartamentos">

                <label>Check-in</label>
                <input type="date" id="checkin">

                <label>Check-out</label>
                <input type="date" id="checkout">

                <!-- VALORES -->
                <div class="modal-section-title">Valores</div>

                <label>Total Bruto (€)</label>
                <input type="number" id="totalBruto">

                <label>Limpeza (€)</label>
                <input type="number" id="limpeza">

                <label>Valor Pago Parcial (€)</label>
                <input type="number" id="valorPagoParcial">

                <label>Valor Pago Final (€)</label>
                <input type="number" id="valorPagoFinal">

                <label>Valor em Falta (€)</label>
                <input type="number" id="valorEmFalta" readonly>

                <label>Status Pagamento</label>
                <select id="statusPagamento">
                    <option value="aguardar">Por receber</option>
                    <option value="parcial">Pago parcialmente</option>
                    <option value="total">Pago totalmente</option>
                </select>

                <label>Preço por Noite (€)</label>
                <input type="number" id="precoNoite" readonly>

                <label>Líquido (€)</label>
                <input type="number" id="liquido" readonly>

                <!-- AVISO DE CONFLITOS -->
                <div id="avisoConflitos" style="display:none; color:#c62828; font-weight:bold;"></div>

            </div>

            <div class="modal-footer">
                <button class="btnSecundario" onclick="fecharModal()">Cancelar</button>
                <button class="btnPrimario" id="btnGuardarReserva">Guardar</button>
            </div>

        </div>
    </div>

    <!-- XLSX -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <script src="js/firebase-config.js"></script>

    <!-- MODELOS E UTILITÁRIOS -->
    <script src="js/models/ReservaModel.js"></script>
    <script src="js/utils/ReservaUtils.js"></script>
    <script src="js/utils/ReservaFinanceiro.js"></script>
    <script src="js/utils/AlocacaoEngine.js"></script>
    <script src="js/importadores/BookingImportEngine.js"></script>

    <!-- SERVIÇOS -->
    <script src="js/services/ReservaService.js"></script>

    <!-- LÓGICA PRINCIPAL (ÚLTIMO) -->
    <script src="js/reservas-listagem.js"></script>

</body>
</html>
