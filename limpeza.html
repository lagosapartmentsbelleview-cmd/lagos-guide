<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Painel de Limpeza</title>

    <!-- Firebase v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <!-- Configuração Firebase -->
    <script src="js/firebase-config.js"></script>

    <!-- Verificar login -->
    <script>
        firebase.auth().onAuthStateChanged(user => {
            if (!user) window.location.href = "login.html";
        });
    </script>

    <link rel="stylesheet" href="css/limpeza.css">
</head>

<body>

    <!-- TOPO -->
    <header class="topo">
        <h1>Painel de Limpeza</h1>

        <div class="filtros">
            <label>Início:
                <input type="date" id="dataInicio">
            </label>

            <label>Fim:
                <input type="date" id="dataFim">
            </label>

            <button id="btnGerar" class="btn-primario">Gerar</button>
        </div>
    </header>

    <!-- PAINEL ADMIN -->
    <section id="painelAdmin" class="painel-admin fechado">
        <div class="painel-admin-header">
            <span id="toggleAdmin">▶</span>
            <h2>Administração</h2>
        </div>

        <div class="painel-admin-body">
            <p><strong>Total Check-outs:</strong> <span id="totalCheckouts">0</span></p>
            <p><strong>Total Base:</strong> €<span id="totalBase">0.00</span></p>
            <p><strong>Total Extras:</strong> €<span id="totalExtras">0.00</span></p>
            <p><strong>Total Geral:</strong> €<span id="totalGeral">0.00</span></p>
            <p><strong>Pagamento Previsto:</strong> <span id="dataPagamento">—</span></p>
        </div>
    </section>

    <!-- LISTA -->
    <section class="secao">
        <h2>Lista de Limpeza</h2>
        <button class="btn-primario" onclick="exportarExcel()">Exportar Excel</button>
        <button class="btn-primario" onclick="exportarPDF()">Exportar PDF</button>
        <table id="tabelaLimpeza" class="tabela">
            <thead>
                <tr>
                    <th>Cliente</th>
                    <th>Apt</th>
                    <th>Check-in</th>
                    <th>Check-out</th>
                    <th>Hósp.</th>
                    <th>Ad.</th>
                    <th>Cr.</th>
                    <th>Idades</th>
                    <th>Berço</th>
                    <th>Comentários</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </section>

    <!-- CALENDÁRIO -->
    <section class="secao">
        <h2>Calendário</h2>
        <div id="calendarioContainer"></div>
    </section>

   <!-- JS -->
<script src="js/reservas-core.js"></script>
<script src="js/limpeza.js"></script>

<!-- Bibliotecas para exportação -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
window.addEventListener("load", function () {

    // EXPORTAR EXCEL
    window.exportarExcel = function () {
        const tabela = document.querySelector(".tabela");
        const wb = XLSX.utils.table_to_book(tabela, { sheet: "Limpeza" });
        XLSX.writeFile(wb, "limpeza.xlsx");
    };

    // EXPORTAR PDF
    window.exportarPDF = function () {

        const secoes = document.querySelectorAll(".secao");
        console.log("Secções encontradas:", secoes);

        const listaSecao = secoes[0];
        const calendarioSecao = secoes[1];

        if (!listaSecao || !calendarioSecao) {
            alert("Erro ao gerar PDF: secções não encontradas.");
            return;
        }

        const wrapper = document.createElement("div");
        wrapper.style.width = "100%";
        wrapper.style.boxSizing = "border-box";

        const listaClone = listaSecao.cloneNode(true);
        wrapper.appendChild(listaClone);

        const calendarioClone = calendarioSecao.cloneNode(true);
        calendarioClone.style.pageBreakBefore = "always";
        wrapper.appendChild(calendarioClone);

        document.body.appendChild(wrapper);

        const opt = {
    margin: [10, 5, 10, 0], // [top, right, bottom, left]
    filename: "limpeza_completa.pdf",
    html2canvas: { scale: 2, useCORS: true },
    jsPDF: { unit: "mm", format: "a4", orientation: "landscape" },
    pagebreak: { mode: ['css', 'legacy'] }
};


        html2pdf()
            .set(opt)
            .from(wrapper)
            .save()
            .then(() => {
                document.body.removeChild(wrapper);
            });
    };

});
</script>

</body>
</html>


